/*  -------------------------------------------------- */
/*  Generated by Enterprise Architect Version 7.5.844*/
/*  Created On : reede, 04 juuni, 2010 */
/*  DBMS       : Oracle */
/*  -------------------------------------------------- */

/* Create Tables */
CREATE TABLE &&ADIT_SCHEMA..ACCESS_RESTRICTION
(
	ID                  NUMBER(18) NOT NULL,	
	remote_application  VARCHAR2(50) NOT NULL,    /* Viide vĆ¤lisele infosĆ¼steemile (infosĆ¼steemi lĆ¼hinimi). */
	user_code           VARCHAR2(50) NOT NULL,    /* Viide kasutajale, kelle puhul antud piirang rakendub. */
	restriction         VARCHAR2(50)    /* MĆ¤Ć¤rab Ć¤ra piirangu tĆ¼Ć¼bi. "WRITE" - kasutaja andmete muutmise piirang, "READ" - tĆ¤ielik piirang (infosĆ¼steemil puudub Ćµigus kasutaja andmete lugemiseks, samuti ka muutmiseks). */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..ACCESS_RESTRICTION IS 'InfosĆ¼steemide ligipĆ¤Ć¤supiirangud kasutajate lĆµikes. InfosĆ¼steemidele saab mĆ¤Ć¤rata piiranguid kasutajate nimel tegevuste lĆ¤bi viimiseks rakenduses.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ACCESS_RESTRICTION.remote_application  IS 'Viide vĆ¤lisele infosĆ¼steemile (infosĆ¼steemi lĆ¼hinimi).';
COMMENT ON COLUMN &&ADIT_SCHEMA..ACCESS_RESTRICTION.user_code           IS 'Viide kasutajale, kelle puhul antud piirang rakendub.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ACCESS_RESTRICTION.restriction         IS 'MĆ¤Ć¤rab Ć¤ra piirangu tĆ¼Ć¼bi. "WRITE" - kasutaja andmete muutmise piirang, "READ" - tĆ¤ielik piirang (infosĆ¼steemil puudub Ćµigus kasutaja andmete lugemiseks, samuti ka muutmiseks).';

CREATE TABLE &&ADIT_SCHEMA..ADIT_LOG
(
	ID                             NUMBER(18) NOT NULL,
	table_name                     VARCHAR2(50),    /* Muutunud vĆ¤Ć¤rtuse tabeli nimi */
	column_name                    VARCHAR2(50),    /* Muutunud vĆ¤Ć¤rtuse tabeli veeru nimi */
	old_value                      VARCHAR2(4000),    /* Vana vĆ¤Ć¤rtus */
	new_value                      VARCHAR2(4000),    /* Uus vĆ¤Ć¤rtus */
	log_date                       DATE,    /* Muudatuse aeg */
	primary_key_value			   VARCHAR2(100), 	/* PrimaarvĆµtme vĆ¤Ć¤rtus */
	remote_application_short_name  VARCHAR2(50),    /* InfosĆ¼steem, kes antud muudatuse vĆ¤lja kutsus. */
	xtee_user_code                 VARCHAR2(50),    /* X-tee pĆ¤ringu isikukood */
	xtee_institution_code          VARCHAR2(50),    /* X-tee pĆ¤ringu ettevĆµtte registrikood */
	db_user                        VARCHAR2(50)    /* Andmebaasikasutaja nimi. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..ADIT_LOG IS 'Andmed kĆµikide andmebaasis tehtud muudatuste kohta. VĆ¤lja arvatud tabeli DOCUMENT_FILES veeru FILE_DATA muudatused.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.table_name                     IS 'Muutunud vĆ¤Ć¤rtuse tabeli nimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.column_name                    IS 'Muutunud vĆ¤Ć¤rtuse tabeli veeru nimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.old_value                      IS 'Vana vĆ¤Ć¤rtus';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.new_value                      IS 'Uus vĆ¤Ć¤rtus';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.log_date                       IS 'Muudatuse aeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.remote_application_short_name  IS 'InfosĆ¼steem, kes antud muudatuse vĆ¤lja kutsus.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.xtee_user_code                 IS 'X-tee pĆ¤ringu isikukood';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.xtee_institution_code          IS 'X-tee pĆ¤ringu ettevĆµtte registrikood';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_LOG.db_user                        IS 'Andmebaasikasutaja nimi.';

CREATE TABLE &&ADIT_SCHEMA..ADIT_USER
(
	user_code                   VARCHAR2(50) NOT NULL,    /* Kasutaja isiku vĆµi registrikood koos riigitunnusega. Nt. "EE38407089945". */
	full_name                   VARCHAR2(255),    /* Kasutaja tĆ¤ispikk nimi. */
	usertype                    VARCHAR2(50) NOT NULL,    /* Viide kasutaja tĆ¼Ć¼bile. */
	active                      NUMBER(1) DEFAULT 1,    /* NĆ¤itab, kas tegemist on aktiivse kasutajaga. "1" - aktiivne", "0" - mitteaktiivne. */
	dvk_org_code                VARCHAR2(50),    /* Kui kasutaja kasutab dokumentide saatmiseks ja vastuvĆµtmiseks DVK-d, siis on see vĆ¤li tĆ¤idetud. VĆ¤ljale kirjutatakse kasutaja DVK asutuse registrikood. */
	dvk_subdivision_short_name  VARCHAR2(50),    /* Kui kasutaja kasutab dokumentide saatmiseks ja vastuvĆµtmiseks DVK-d, siis on see vĆ¤li tĆ¤idetud juhul kui asutusel on DVK-s registreeritud vastav allĆ¼ksus. VĆ¤ljale kirjutatakse kasutaja DVK asutuse allĆ¼ksuse lĆ¼hinimi. */
	dvk_occupation_short_name   VARCHAR2(50),    /* Kui kasutaja kasutab dokumentide saatmiseks ja vastuvĆµtmiseks DVK-d, siis on see vĆ¤li tĆ¤idetud juhul kui asutusel on DVK-s registreeritud vastav ametikoht. VĆ¤ljale kirjutatakse kasutaja DVK asutuse ametikoha lĆ¼hinimi. */
	disk_quota                  NUMBER(18),    /* Kasutaja failide mahupiirang baitides. Kasutajale mĆ¤Ć¤ratud mahupiirang omab prioriteeti kasutajatĆ¼Ć¼bi mahupiirangu Ć¼le. */
	deactivation_date			DATE	/* Kasutajakonto kustutamise / deaktiveerimise kellaaeg ja kuupĆ¤ev */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..ADIT_USER IS 'Kasutaja andmed. Kasutaja on alati isik, kelle mĆ¤Ć¤rab Ć¼heselt isikukood. Isik vĆµib sĆ¼steemis esindada kas iseennast vĆµi asutust.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.user_code                   IS 'Kasutaja isiku vĆµi registrikood koos riigitunnusega. Nt. "EE38407089945".';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.full_name                   IS 'Kasutaja tĆ¤ispikk nimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.usertype                    IS 'Viide kasutaja tĆ¼Ć¼bile.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.active                      IS 'NĆ¤itab, kas tegemist on aktiivse kasutajaga. "1" - aktiivne", "0" - mitteaktiivne.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.dvk_org_code                IS 'Kui kasutaja kasutab dokumentide saatmiseks ja vastuvĆµtmiseks DVK-d, siis on see vĆ¤li tĆ¤idetud. VĆ¤ljale kirjutatakse kasutaja DVK asutuse registrikood.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.dvk_subdivision_short_name  IS 'Kui kasutaja kasutab dokumentide saatmiseks ja vastuvĆµtmiseks DVK-d, siis on see vĆ¤li tĆ¤idetud juhul kui asutusel on DVK-s registreeritud vastav allĆ¼ksus. VĆ¤ljale kirjutatakse kasutaja DVK asutuse allĆ¼ksuse lĆ¼hinimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.dvk_occupation_short_name   IS 'Kui kasutaja kasutab dokumentide saatmiseks ja vastuvĆµtmiseks DVK-d, siis on see vĆ¤li tĆ¤idetud juhul kui asutusel on DVK-s registreeritud vastav ametikoht. VĆ¤ljale kirjutatakse kasutaja DVK asutuse ametikoha lĆ¼hinimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ADIT_USER.disk_quota                  IS 'Kasutaja failide mahupiirang baitides. Kasutajale mĆ¤Ć¤ratud mahupiirang omab prioriteeti kasutajatĆ¼Ć¼bi mahupiirangu Ć¼le.';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT
(
	ID                      NUMBER(12) NOT NULL,    /* Unikaalne identifikaator */
	guid                    VARCHAR2(50),    /* Dokumendi globaalselt unikaalne identifikaator. Kui dokument vĆµetakse vastu DVK-st, siis tuleb ka GUID sealt. Kui dokument luuakse ADIT-is, siis genereerib ADIT ise GUID. */
	title                   VARCHAR2(255),    /* Dokumendi pealkiri. */
	type                    VARCHAR2(50) NOT NULL,    /* Viide dokumendi tĆ¼Ć¼bi lĆ¼hinimele. */
	creator_code            VARCHAR2(50) NOT NULL,    /* Dokumendi looja isikukood. */
	creator_name            VARCHAR2(255) NULL,    /* Dokumendi looja nimi (loomise hetke seisuga) */
	creator_user_code       VARCHAR2(50) NULL,    /* Dokumendi loonud isiku isikukood (juhul, kui dokument kuulub asutusele). */
	creator_user_name       VARCHAR2(255) NULL,    /* Dokumendi loonud isiku nimi (juhul, kui dokument kuulub asutusele; loomise hetke seisuga) */
	creation_date           DATE,    /* Dokumendi loomise kuupĆ¤ev ja kellaaeg */
	remote_application      VARCHAR2(50),    /* Viide pĆ¤ringu vĆ¤lja kutsunud infosĆ¼steemi lĆ¼hinimele. */
	last_modified_date      DATE,    /* Viimase muudatuse kuupĆ¤ev ja kellaaeg. */
	document_dvk_status_id  NUMBER(12),    /* Kui dokument on saadetud Ć¼le DVK vĆµi vĆµetud vastu DVK-st, siis kirjutatakse siia vĆ¤ljale dokumendi DVK staatuse idenfitikaator */
	dvk_id                  NUMBER(12),    /* Kui tegemist on DVK-st tulnud dokumendiga, siis kirjutatakse siia dokumendile DVK poolt antud ID */
	document_wf_status_id   NUMBER(12),    /* Viide dokumendi tĆ¶Ć¶voo staatusele. */
	parent_id               NUMBER(12),    /* Kui on tegemist alamdokumendiga, siis viide nn peadokumendile */
	locked                  NUMBER(1) DEFAULT 0,    /* NĆ¤itab, kas dokument on "lukustatud". "1" - lukus, "0" - lukustamata. */
	locking_date            DATE,    /* Lukustamise kuupĆ¤ev ja kellaaeg */
	signable                NUMBER(1) DEFAULT 0,    /* NĆ¤itab, kas dokument on allkirjastatav. */
	deflated                NUMBER(1) DEFAULT 0,    /* NĆ¤itab, kas dokument on arhiveeritud. "1" - arhiveeritud, "0" - ei ole arhiveeritud */
	deflate_date            DATE,    /* Arhiveerimise kuupĆ¤ev ja kellaaeg. */
	deleted                 NUMBER(1),    /* NĆ¤itab, kas dokument on kustutatud. "1" - kustutatud, "0" - kustutamata. */
	signature_container		BLOB	/* Digitaalallkirja konteiner (ddoc vĆµi bdoc fail) */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT IS 'Dokumendi andmed.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.ID                      IS 'Unikaalne identifikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.guid                    IS 'Dokumendi globaalselt unikaalne identifikaator. Kui dokument vĆµetakse vastu DVK-st, siis tuleb ka GUID sealt. Kui dokument luuakse ADIT-is, siis genereerib ADIT ise GUID.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.title                   IS 'Dokumendi pealkiri.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.type                    IS 'Viide dokumendi tĆ¼Ć¼bi lĆ¼hinimele.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.creator_code            IS 'Dokumendi looja isikukood.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.creator_name            IS 'Dokumendi looja nimi (loomise hetke seisuga)';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.creator_user_code       IS 'Dokumendi loonud isiku isikukood (juhul, kui dokument kuulub asutusele).';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.creator_user_name       IS 'Dokumendi loonud isiku nimi (juhul, kui dokument kuulub asutusele; loomise hetke seisuga)';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.creation_date           IS 'Dokumendi loomise kuupĆ¤ev ja kellaaeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.remote_application      IS 'Viide pĆ¤ringu vĆ¤lja kutsunud infosĆ¼steemi lĆ¼hinimele.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.last_modified_date      IS 'Viimase muudatuse kuupĆ¤ev ja kellaaeg.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.document_dvk_status_id  IS 'Kui dokument on saadetud Ć¼le DVK vĆµi vĆµetud vastu DVK-st, siis kirjutatakse siia vĆ¤ljale dokumendi DVK staatuse idenfitikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.dvk_id                  IS 'Kui tegemist on DVK-st tulnud dokumendiga, siis kirjutatakse siia dokumendile DVK poolt antud ID';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.document_wf_status_id   IS 'Viide dokumendi tĆ¶Ć¶voo staatusele.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.parent_id               IS 'Kui on tegemist alamdokumendiga, siis viide nn peadokumendile';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.locked                  IS 'NĆ¤itab, kas dokument on "lukustatud". "1" - lukus, "0" - lukustamata.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.locking_date            IS 'Lukustamise kuupĆ¤ev ja kellaaeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.signable                IS 'NĆ¤itab, kas dokument on allkirjastatav.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.deflated                IS 'NĆ¤itab, kas dokument on arhiveeritud. "1" - arhiveeritud, "0" - ei ole arhiveeritud';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.deflate_date            IS 'Arhiveerimise kuupĆ¤ev ja kellaaeg.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.deleted                 IS 'NĆ¤itab, kas dokument on kustutatud. "1" - kustutatud, "0" - kustutamata.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT.signature_container     IS 'Digitaalallkirja konteiner (ddoc vĆµi bdoc fail)';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS
(
	ID           NUMBER(12) NOT NULL,    /* DVK staatuse unikaalne identifikaator */
	description  VARCHAR2(4000)    /* DVK staatuse kirjeldus */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS IS 'Dokumendi DVK staatused (kattuvad DVK staatustega). Staatused on jĆ¤rgmised: 
 1. Puudub (100) 2. Saatmisel (101) 3. Saadetud (102) 4. Katkestatud (103)';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS.ID           IS 'DVK staatuse unikaalne identifikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS.description  IS 'DVK staatuse kirjeldus';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_FILE
(
	ID               NUMBER(12) NOT NULL,    /* Unikaalne identifikaator */
	document_id      NUMBER(12) NOT NULL,    /* Viide dokumendi ID-le */
	file_name        VARCHAR2(255) NOT NULL,    /* Faili nimi. (Nt. "avaldus.doc") */
	content_type     VARCHAR2(255),    /* Faili MIME tĆ¼Ć¼p. (Nt. "application/rtf") */
	description      VARCHAR2(4000),    /* Faili kirjeldus. */
	file_data        BLOB,    /* Faili sisu binaarkujul */
	file_size_bytes  NUMBER(38),    /* Faili suurus baitides */
	deleted          NUMBER(1) DEFAULT 0 /* Kas antud fail on kustutatud */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_FILE IS 'Dokumendi juurde kuuluvate failide andmed.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.ID               IS 'Unikaalne identifikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.document_id      IS 'Viide dokumendi ID-le';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.file_name        IS 'Faili nimi. (Nt. "avaldus.doc")';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.content_type     IS 'Faili MIME tĆ¼Ć¼p. (Nt. "application/rtf")';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.description      IS 'Faili kirjeldus.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.file_data        IS 'Faili sisu binaarkujul';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.file_size_bytes  IS 'Faili suurus baitides';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_FILE.deleted          IS 'Kas antud fail on kustutatud';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY
(
	ID                     NUMBER(12) NOT NULL,    /* Unikaalne identifikaator */
	document_id            NUMBER(12) NOT NULL,    /* Viide dokumendile, millega ajalookirje on seotud */
	document_history_type  VARCHAR2(50),    /* Viide dokumendi ajaloo tĆ¼Ć¼bile. */
	description            VARCHAR2(4000),    /* Toimingu tĆ¤psem kirjeldus, kui vajalik. */
	event_date             DATE,    /* Tegevuse kuupĆ¤ev ja kelaaaeg */
	user_code              VARCHAR2(50),    /* Tegevuse lĆ¤bi viinud kasutaja kood. Viide kasutajale. */
	user_name              VARCHAR2(255),    /* Tegevuse lĆ¤bi viinud kasutaja nimi (tegevuse toimumise hetke seisuga). */
	remote_application     VARCHAR2(50),    /* Viide vĆ¤lisele infosĆ¼steemile (vĆ¤lise infosĆ¼steemi lĆ¼hinimi), mis antud toimingu vĆ¤lja kutsus. */
	notification_status    VARCHAR2(50),    /* Teavituse saatmise staatus. Kui teavistus on saatmata, siis "SAADA", kui saadetud, siis "SAADETUD". Kui teavitust ei ole vaja saata, siis vĆ¤li tĆ¼hi (NULL). */
	xtee_notification_id   VARCHAR2(50),    /* Teavituskalendri X-tee teenuselt saadud teavituse ID. See vĆ¤li tĆ¤idetakse juhul kui teavituse saatmine teavituskalendrile Ćµnnestus. */
	xtee_user_code         VARCHAR2(50),    /* X-tee kasutaja isikukood, kes tegevuse kĆ¤ivitas. See on vajalik selleks, et asutuse dokumentide puhul teada, milline konkreetne isik tegevuse lĆ¤bi viis. */
	xtee_user_name         VARCHAR2(255)    /* X-tee kasutaja nimi (kui oli vĆµimalik tuvastada) */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY IS 'Dokumendi ajalookirjed. Kirje tekib siis, kui dokumendiga viiakse lĆ¤bi toiming. Tabel koondab endasse dokumendiga teostatud toimingute ajaloo.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.ID                     IS 'Unikaalne identifikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.document_id            IS 'Viide dokumendile, millega ajalookirje on seotud';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.document_history_type  IS 'Viide dokumendi ajaloo tĆ¼Ć¼bile.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.description            IS 'Toimingu tĆ¤psem kirjeldus, kui vajalik.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.event_date             IS 'Tegevuse kuupĆ¤ev ja kelaaaeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.user_code              IS 'Tegevuse lĆ¤bi viinud isiku kood. Viide kasutajale.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.user_name              IS 'Tegevuse lĆ¤bi viinud kasutaja nimi (tegevuse toimumise hetke seisuga).';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.remote_application     IS 'Viide vĆ¤lisele infosĆ¼steemile (vĆ¤lise infosĆ¼steemi lĆ¼hinimi), mis antud toimingu vĆ¤lja kutsus.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.notification_status    IS 'Teavituse saatmise staatus. Kui teavistus on saatmata, siis "SAADA", kui saadetud, siis "SAADETUD". Kui teavitust ei ole vaja saata, siis vĆ¤li tĆ¼hi (NULL).';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.xtee_notification_id   IS 'Teavituskalendri X-tee teenuselt saadud teavituse ID. See vĆ¤li tĆ¤idetakse juhul kui teavituse saatmine teavituskalendrile Ćµnnestus.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.xtee_user_code         IS 'X-tee kasutaja isikukood, kes tegevuse kĆ¤ivitas. See on vajalik selleks, et asutuse dokumentide puhul teada, milline konkreetne isik tegevuse lĆ¤bi viis.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY.xtee_user_name         IS 'X-tee kasutaja nimi (kui oli vĆµimalik tuvastada)';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY_TYPE
(
	short_name   VARCHAR2(50) NOT NULL,    /* Ajalookirje tĆ¼Ć¼bi nimi. Nt. "esmane loomine" vĆµi "dokumendi muutmine". */
	description  VARCHAR2(4000)    /* Ajalookirje tĆ¼Ć¼bi kirjeldus. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY_TYPE IS 'Dokumendi ajalookirjete tĆ¼Ć¼bid. Ajalookirjete tĆ¼Ć¼bid on nĆ¤iteks "esmane loomine", "dokumendi muutmine" jne. (tĆ¤psemalt on kirjeldatud dokumentatsioonis). Ajalookirjete tĆ¼Ć¼bid on jĆ¤rgmised: 
 1. Esmane loomine 2. Dokumendi muutmine 3. Dokumendi faili lisamine 4. Dokumendi faili muutmine 5. Dokumendi faili kustutamine 6. Staatuse muutmine 7. Saatmine 8. Jagamine 9. Lukustamine 10. Arhiveerimine 11. Dokumendi digitaalne allkirjastamine 12. Kustutamine';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY_TYPE.short_name   IS 'Ajalookirje tĆ¼Ć¼bi nimi. Nt. "esmane loomine" vĆµi "dokumendi muutmine".';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_HISTORY_TYPE.description  IS 'Ajalookirje tĆ¼Ć¼bi kirjeldus.';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING
(
	ID                NUMBER(12) NOT NULL,    /* Unikaalne identifikaator */
	document_id       NUMBER(12) NOT NULL,    /* Viide dokumendile */
	user_code         VARCHAR2(50) NOT NULL,    /* Viide kasutajale (isikukood), kellele dokument jagati */
	user_name		  VARCHAR2(255) NULL,		/* Kasutaja nimi (jagamise hetke seisuga) */
	sharing_type      VARCHAR2(50) NOT NULL,    /* Viide dokumendi jagamise tĆ¼Ć¼bile. Viidatakse kasutades dokumendi tĆ¼Ć¼bi lĆ¼hinime. */
	task_description  VARCHAR2(4000),    /* Jagamise eesmĆ¤rk. Toiming, mida jagamise adressaat peaks dokumendiga tegema. */
	creation_date     DATE,    /* Jagamise kuupĆ¤ev ja kellaaeg */
	dvk_status_id     NUMBER(12),    /* Dokumendi DVK staatuse ID. NĆ¤itab, millises staatuses on jagatud dokument adressaadi DVK-s. */
	wf_status_id      NUMBER(12),    /* TĆ¶Ć¶voo staatuse ID */
	last_access_date  DATE,    /* KuupĆ¤ev ja kellaaeg, millal viimati jagatud dokumendi andmeid vaadati. */
	dvk_send_date	  DATE	   /* Kuupäev ja kellaaeg, millal saadeti dokument DVK-sse (juhul kui tegemist on DVK-sse saatmisega) */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING IS 'Dokumendi jagamise andmed.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.ID                IS 'Unikaalne identifikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.document_id       IS 'Viide dokumendile';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.user_code         IS 'Viide kasutajale (isikukood), kellele dokument jagati';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.user_name         IS 'Kasutaja nimi (jagamise hetke seisuga)';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.sharing_type      IS 'Viide dokumendi jagamise tĆ¼Ć¼bile. Viidatakse kasutades dokumendi tĆ¼Ć¼bi lĆ¼hinime.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.task_description  IS 'Jagamise eesmĆ¤rk. Toiming, mida jagamise adressaat peaks dokumendiga tegema.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.creation_date     IS 'Jagamise kuupĆ¤ev ja kellaaeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.dvk_status_id     IS 'Dokumendi DVK staatuse ID. NĆ¤itab, millises staatuses on jagatud dokument adressaadi DVK-s.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.wf_status_id      IS 'TĆ¶Ć¶voo staatuse ID';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING.last_access_date  IS 'KuupĆ¤ev ja kellaaeg, millal viimati jagatud dokumendi andmeid vaadati.';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING_TYPE
(
	short_name   VARCHAR2(50) NOT NULL,    /* Dokumendi jagamise tĆ¼Ć¼bi lĆ¼hinimi. (Nt. "sending", "sharing"). LĆ¼hinimed on inglisekeelsed. */
	description  VARCHAR2(4000)    /* Dokumendi jagamise tĆ¼Ć¼bi kirjeldus. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING_TYPE IS 'Dokumendi jagamise tĆ¼Ć¼bid: 
 1. Allkirjastamine 2. Jagamine 3. DVK Saatmine 4. ADIT Saatmine';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING_TYPE.short_name   IS 'Dokumendi jagamise tĆ¼Ć¼bi lĆ¼hinimi. (Nt. "sending", "sharing"). LĆ¼hinimed on inglisekeelsed.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_SHARING_TYPE.description  IS 'Dokumendi jagamise tĆ¼Ć¼bi kirjeldus.';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_TYPE
(
	short_name   VARCHAR2(50) NOT NULL,    /* Dokumendi tĆ¼Ć¼bi lĆ¼hinimi. */
	description  VARCHAR2(4000)    /* Dokumendi tĆ¼Ć¼bi kirjeldus. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_TYPE IS 'Dokumendi tĆ¼Ć¼pide kirjeldused. Neid liike lisandub tĆ¶Ć¶ kĆ¤igus, kuid esialgselt on olemas: 
 1. Kiri (letter) 2. Avaldus / Taotlus (application)';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_TYPE.short_name   IS 'Dokumendi tĆ¼Ć¼bi lĆ¼hinimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_TYPE.description  IS 'Dokumendi tĆ¼Ć¼bi kirjeldus.';

CREATE TABLE &&ADIT_SCHEMA..DOCUMENT_WF_STATUS
(
	ID           NUMBER(12) NOT NULL,    /* Unikaalne identifikaator */
	description  VARCHAR2(4000),    /* TĆ¶Ć¶voo staatuse kirjeldus */
	name         VARCHAR2(50)    /* Dokumendi tĆ¶Ć¶voo staatuse nimetus. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOCUMENT_WF_STATUS IS 'TĆ¶Ć¶voo staatused. Staatused on jĆ¤rgmised: 
 1. Puudub (lokaalse faili puhul) 2. Dokumente on puudu 3. JĆ¤rjekorras 4. Ootel 5. LĆµpetatud 6. Tagasi lĆ¼katud 7. Teha 8. TĆ¶Ć¶tlemisel 9. Aktsepteeritud (vĆµetud tĆ¶Ć¶sse) 10. Salvestatud 11. Arhiveeritud 12. Saadetud';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_WF_STATUS.ID           IS 'Unikaalne identifikaator';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_WF_STATUS.description  IS 'TĆ¶Ć¶voo staatuse kirjeldus';
COMMENT ON COLUMN &&ADIT_SCHEMA..DOCUMENT_WF_STATUS.name         IS 'Dokumendi tĆ¶Ć¶voo staatuse nimetus.';

CREATE TABLE &&ADIT_SCHEMA..DOWNLOAD_REQUEST_LOG
(
	ID                             NUMBER(18) NOT NULL,
	document_id                    NUMBER(12),
	document_file_id               NUMBER(12),
	request_date                   DATE,
	remote_application_short_name  VARCHAR2(50),
	user_code                      VARCHAR2(50),
	organization_code              VARCHAR2(50)
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..DOWNLOAD_REQUEST_LOG IS 'AllalaadimispĆ¤ringute logi. Siia tabelisse kirjutatakse andmed juhul kui kĆ¤ivitatakse Ć¼ks jĆ¤rgmistest pĆ¤ringutest: 
 - getDocument (juhul kui pĆ¤ringu parameetri "kas tagastada ka failide sisu" vĆ¤Ć¤rtuseks on "jah") - getDocumentFile';

CREATE TABLE &&ADIT_SCHEMA..ERROR_LOG
(
	ID                             NUMBER(18) NOT NULL,
	document_id                    NUMBER(12),    /* Dokument, mille tĆ¶Ć¶tlemisel vĆµi millega seotud tegevuse ebaĆµnnestumisel viga tekkis. */
	error_date                     DATE,    /* Vea tekkimise aeg */
	remote_application_short_name  VARCHAR2(50),    /* PĆ¤ringu teinud infosĆ¼steemi lĆ¼hinimi. */
	user_code                      VARCHAR2(50),    /* PĆ¤ringuga seotud isiku kood */
	action_name                    VARCHAR2(255),    /* PĆ¤ringu vĆµi toimingu nimi, mille tĆ¤itmisel viga ilmnes. */
	error_level                    VARCHAR2(50),    /* Vea raskusaste (FATAL, ERROR, WARNING) */
	error_message                  VARCHAR2(4000)    /* Veateate sisu */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.document_id                    IS 'Dokument, mille tĆ¶Ć¶tlemisel vĆµi millega seotud tegevuse ebaĆµnnestumisel viga tekkis.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.error_date                     IS 'Vea tekkimise aeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.remote_application_short_name  IS 'PĆ¤ringu teinud infosĆ¼steemi lĆ¼hinimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.user_code                      IS 'PĆ¤ringuga seotud isiku kood';
COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.action_name                    IS 'PĆ¤ringu vĆµi toimingu nimi, mille tĆ¤itmisel viga ilmnes.';
COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.error_level                    IS 'Vea raskusaste (FATAL, ERROR, WARNING)';
COMMENT ON COLUMN &&ADIT_SCHEMA..ERROR_LOG.error_message                  IS 'Veateate sisu';

CREATE TABLE &&ADIT_SCHEMA..METADATA_REQUEST_LOG
(
	ID                             NUMBER(18) NOT NULL,
	document_id                    NUMBER(12) NOT NULL,    /* Dokumendi ID, mida vaadati. */
	request_date                   DATE,    /* PĆ¤ringu tegemise aeg. */
	remote_application_short_name  VARCHAR2(50),    /* PĆ¤ringu teinud infosĆ¼steemi lĆ¼hinimi. */
	user_code                      VARCHAR2(50),    /* Isik, kelle nimel pĆ¤ring tehti (kas eraisikuna vĆµi juriidilise isiku esindajana) */
	organization_code              VARCHAR2(50)    /* Juriidilise isiku registrikood */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..METADATA_REQUEST_LOG IS 'Dokumendi ja metaandmete pĆ¤ringute logi. Andmed kirjutatakse siia tabelisse juhul kui kĆ¤ivitatakse Ć¼ks jĆ¤rgmistest pĆ¤ringutest: 
 - getDocumentList - getDocument';
COMMENT ON COLUMN &&ADIT_SCHEMA..METADATA_REQUEST_LOG.document_id                    IS 'Dokumendi ID, mida vaadati.';
COMMENT ON COLUMN &&ADIT_SCHEMA..METADATA_REQUEST_LOG.request_date                   IS 'PĆ¤ringu tegemise aeg.';
COMMENT ON COLUMN &&ADIT_SCHEMA..METADATA_REQUEST_LOG.remote_application_short_name  IS 'PĆ¤ringu teinud infosĆ¼steemi lĆ¼hinimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..METADATA_REQUEST_LOG.user_code                      IS 'Isik, kelle nimel pĆ¤ring tehti (kas eraisikuna vĆµi juriidilise isiku esindajana)';
COMMENT ON COLUMN &&ADIT_SCHEMA..METADATA_REQUEST_LOG.organization_code              IS 'Juriidilise isiku registrikood';

CREATE TABLE &&ADIT_SCHEMA..NOTIFICATION_TYPE
(
	short_name   VARCHAR2(50) NOT NULL,    /* Teavituse tĆ¼Ć¼bi lĆ¼hinimi */
	description  VARCHAR2(4000)    /* Teavituse tĆ¼Ć¼bi kirjeldus. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..NOTIFICATION_TYPE IS 'Teavituste tĆ¼Ć¼pide andmed. Teavituse tĆ¼bid on jĆ¤rgmised: 
 1. Saatmine (send) 2. Jagamine (share) 3. Vaatamine (view) 4. Muutmine (modify) 5. Allkirjastamine (sign)';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION_TYPE.short_name   IS 'Teavituse tĆ¼Ć¼bi lĆ¼hinimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION_TYPE.description  IS 'Teavituse tĆ¼Ć¼bi kirjeldus.';

CREATE TABLE &&ADIT_SCHEMA..REMOTE_APPLICATION
(
	short_name         VARCHAR2(50) NOT NULL,    /* InfosĆ¼steemi lĆ¼hinimi */
	name               VARCHAR2(50),    /* InfosĆ¼steemi tĆ¤ispikk nimi */
	organization_code  VARCHAR2(50) NOT NULL,    /* InfosĆ¼steemi omaniku (asutuse) registrikood */
	can_read           NUMBER(1) DEFAULT 0,    /* NĆ¤itab, kas infosĆ¼steemil on Ć¼leĆ¼ldine Ćµigus rakenduse abil andmeid lugeda. */
	can_write          NUMBER(1) DEFAULT 0    /* NĆ¤itab, kas infosĆ¼steemil on Ć¼leĆ¼ldine Ćµigus rakenduse abil andmeid muuta. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..REMOTE_APPLICATION IS 'VĆ¤lised infosĆ¼steemid.';
COMMENT ON COLUMN &&ADIT_SCHEMA..REMOTE_APPLICATION.short_name         IS 'InfosĆ¼steemi lĆ¼hinimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..REMOTE_APPLICATION.name               IS 'InfosĆ¼steemi tĆ¤ispikk nimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..REMOTE_APPLICATION.organization_code  IS 'InfosĆ¼steemi omaniku (asutuse) registrikood';
COMMENT ON COLUMN &&ADIT_SCHEMA..REMOTE_APPLICATION.can_read           IS 'NĆ¤itab, kas infosĆ¼steemil on Ć¼leĆ¼ldine Ćµigus rakenduse abil andmeid lugeda.';
COMMENT ON COLUMN &&ADIT_SCHEMA..REMOTE_APPLICATION.can_write          IS 'NĆ¤itab, kas infosĆ¼steemil on Ć¼leĆ¼ldine Ćµigus rakenduse abil andmeid muuta.';

CREATE TABLE &&ADIT_SCHEMA..REQUEST_LOG
(
	ID                             NUMBER(18) NOT NULL,
	request                        VARCHAR2(50),    /* PĆ¤ringu nimi. Nt. "shareDocument" */
	document_id                    NUMBER(12),    /* Dokumendi ID, millega tegevus lĆ¤bi viidi */
	request_date                   DATE,    /* PĆ¤ringu tegemise aeg */
	remote_application_short_name  VARCHAR2(50),    /* PĆ¤ringu teinud infosĆ¼steemi lĆ¼hinimi */
	user_code                      VARCHAR2(50),    /* Isik, kelle nimel pĆ¤ring tehti (kas eraisikuna vĆµi juriidilise isiku esindajana) */
	organization_code              VARCHAR2(50),    /* Juriidilise isiku registrikood */
	additional_information         VARCHAR2(4000)    /* Lisainfo pĆ¤ringu kohta. Nt. "saveDocumentFile" pĆ¤ringu puhul kirjutatakse siia ka manuse ID. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..REQUEST_LOG IS 'PĆ¤ringute tehtud muudatuste logi. Andmed kirjutatakse sellesse tabelisse juhul, kui kĆ¤ivitati Ć¼ks jĆ¤rgmistest pĆ¤ringutest: 
 - saveDocument - saveDocumentFile - deleteDocumentFile - archieveDocument - deleteDocument - getDocumentHistory - sendDocument - shareDocument - unShareDocument - markDocumentViewed - prepareSignature - giveSiganture - modifyStatus';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.request                        IS 'PĆ¤ringu nimi. Nt. "shareDocument"';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.document_id                    IS 'Dokumendi ID, millega tegevus lĆ¤bi viidi';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.request_date                   IS 'PĆ¤ringu tegemise aeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.remote_application_short_name  IS 'PĆ¤ringu teinud infosĆ¼steemi lĆ¼hinimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.user_code                      IS 'Isik, kelle nimel pĆ¤ring tehti (kas eraisikuna vĆµi juriidilise isiku esindajana)';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.organization_code              IS 'Juriidilise isiku registrikood';
COMMENT ON COLUMN &&ADIT_SCHEMA..REQUEST_LOG.additional_information         IS 'Lisainfo pĆ¤ringu kohta. Nt. "saveDocumentFile" pĆ¤ringu puhul kirjutatakse siia ka manuse ID.';

CREATE TABLE &&ADIT_SCHEMA..SIGNATURE
(
	ID              NUMBER(12) NOT NULL,    /* Unikaalne identifikaator. */
	user_code       VARCHAR2(50),    /* Viide kasutajale, kes allkirja andis. */
	document_id     NUMBER(12) NOT NULL,    /* Viide dokumendile, millele allkiri anti. */
	signer_role     VARCHAR2(50),    /* Allkirja metaandmed - roll */
	resolution      VARCHAR2(100),    /* Allkirja metaandmed - resolutsioon */
	country         VARCHAR2(100),    /* Allkirja metaandmed - riik */
	county          VARCHAR2(100),    /* Allkirja metaandmed - maakond */
	city            VARCHAR2(100),    /* Allkirja metaandmed - linn */
	post_index      VARCHAR2(50),    /* Allkirja metaandmed - indeks */
	signer_code		VARCHAR2(20),    /* Allkirja metaandmed - allkirjastaja isikukood */
	signer_name		VARCHAR2(255)    /* Allkirja metaandmed - allkirjastaja nimi */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..SIGNATURE IS 'Allkirjade tabel.';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.ID              IS 'Unikaalne identifikaator.';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.user_code       IS 'Viide kasutajale, kes allkirja andis.';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.document_id     IS 'Viide dokumendile, millele allkiri anti.';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.signer_role     IS 'Allkirja metaandmed - roll';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.resolution      IS 'Allkirja metaandmed - resolutsioon';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.country         IS 'Allkirja metaandmed - riik';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.county          IS 'Allkirja metaandmed - maakond';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.city            IS 'Allkirja metaandmed - linn';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.post_index      IS 'Allkirja metaandmed - indeks';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.signer_code     IS 'Allkirja metaandmed - allkirjastaja isikukood';
COMMENT ON COLUMN &&ADIT_SCHEMA..SIGNATURE.signer_name     IS 'Allkirja metaandmed - allkirjastaja nimi';

CREATE TABLE &&ADIT_SCHEMA..USER_NOTIFICATION
(
	user_code          VARCHAR2(50) NOT NULL,    /* Viide kasutajale (isiku- vĆµi registrikood) */
	notification_type  VARCHAR2(50) NOT NULL    /* Teavituse tĆ¼Ć¼bi lĆ¼hinimi. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..USER_NOTIFICATION IS 'Kasutajate teavituste andmed. Kasutaja saab mĆ¤Ć¤rata, kas ta soovib teatud sĆ¼ndmuste toimumisel saada teavitusi. Teavitused edastatakse teavituskalendrile vastavalt selles tabelis olevale seadistusele.';
COMMENT ON COLUMN &&ADIT_SCHEMA..USER_NOTIFICATION.user_code          IS 'Viide kasutajale (isiku- vĆµi registrikood)';
COMMENT ON COLUMN &&ADIT_SCHEMA..USER_NOTIFICATION.notification_type  IS 'Teavituse tĆ¼Ć¼bi lĆ¼hinimi.';

CREATE TABLE &&ADIT_SCHEMA..USERTYPE
(
	short_name   VARCHAR2(50) NOT NULL,    /* KasutajatĆ¼Ć¼bi lĆ¼hinimi. */
	description  VARCHAR2(4000),    /* KasutajatĆ¼Ć¼bi kirjeldus. */
	disk_quota   NUMBER(18)    /* MĆ¤Ć¤rab kasutajatĆ¼Ć¼bi vaikimisi kehtiva mahupiirangu baitides. */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..USERTYPE IS 'KasutajatĆ¼Ć¼pide andmed. KasutajatĆ¼Ć¼pe on kolm: 
 1. Eraisik (person) 2. EttevĆµte (company) 3. Asutus (institution)';
COMMENT ON COLUMN &&ADIT_SCHEMA..USERTYPE.short_name   IS 'KasutajatĆ¼Ć¼bi lĆ¼hinimi.';
COMMENT ON COLUMN &&ADIT_SCHEMA..USERTYPE.description  IS 'KasutajatĆ¼Ć¼bi kirjeldus.';
COMMENT ON COLUMN &&ADIT_SCHEMA..USERTYPE.disk_quota   IS 'MĆ¤Ć¤rab kasutajatĆ¼Ć¼bi vaikimisi kehtiva mahupiirangu baitides.';


CREATE TABLE &&ADIT_SCHEMA..NOTIFICATION
(
	ID                             NUMBER(18) NOT NULL,      /* Teavituse unikaalne identifikaator kohalikus andmebaasis */
	user_code                      VARCHAR2(50),             /* Isiku vĆµi asutuse kood, kellele teavitus saadeti */
	document_id                    NUMBER(12) NOT NULL,      /* Teavitusega seotud dokumendi ID */
	event_date                     DATE,                     /* Teavitatava sĆ¼ndmuse toimumise kuupĆ¤ev ja kellaaeg */
	notification_type              VARCHAR2(50) NOT NULL,    /* Teavituse tĆ¼Ć¼bi lĆ¼hinimi */
	notification_text              VARCHAR2(4000),           /* Teavituse sisu */
	notification_id                NUMBER(12),               /* Teavituse ID teavituskalendris */
	notification_sending_date      DATE                      /* Teavituse teavituskalendrisse edastamise aeg */
) TABLESPACE &&ADIT_TABLE_TABLESPACE.;

COMMENT ON TABLE &&ADIT_SCHEMA..NOTIFICATION IS 'Teavituskalendri teavitused';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.ID IS 'Teavituse unikaalne identifikaator kohalikus andmebaasis';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.user_code IS 'Isiku vĆµi asutuse kood, kellele teavitus saadeti';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.document_id IS 'Teavitusega seotud dokumendi ID';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.event_date IS 'Teavitatava sĆ¼ndmuse toimumise kuupĆ¤ev ja kellaaeg';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.notification_type IS 'Teavituse tĆ¼Ć¼bi lĆ¼hinimi';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.notification_text IS 'Teavituse sisu';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.notification_id IS 'Teavituse ID teavituskalendris';
COMMENT ON COLUMN &&ADIT_SCHEMA..NOTIFICATION.notification_sending_date IS 'Teavituse teavituskalendrisse edastamise aeg';


/* Create Primary Key Constraints */
ALTER TABLE &&ADIT_SCHEMA..ACCESS_RESTRICTION ADD CONSTRAINT PK_ACCESS_RESTRICTIONS 
	PRIMARY KEY (remote_application, user_code) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..ADIT_LOG ADD CONSTRAINT PK_ADIT_LOG 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..ADIT_USER ADD CONSTRAINT PK_USERS 
	PRIMARY KEY (user_code) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT ADD CONSTRAINT PK_DOCUMENTS 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS ADD CONSTRAINT PK_DOCUMENT_DVK_STATUSES 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_FILE ADD CONSTRAINT PK_DOCUMENT_FILES 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY ADD CONSTRAINT PK_DOCUMENT_HISTORY 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY_TYPE ADD CONSTRAINT PK_DOCUMENT_HISTORY_TYPE 
	PRIMARY KEY (short_name) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING ADD CONSTRAINT PK_DOCUMENT_SHARINGS 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING_TYPE ADD CONSTRAINT PK_DOCUMENT_SHARING_TYPES 
	PRIMARY KEY (short_name) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_TYPE ADD CONSTRAINT PK_DOCUMENT_TYPES 
	PRIMARY KEY (short_name) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_WF_STATUS ADD CONSTRAINT PK_DOCUMENT_WF_STATUSES 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..DOWNLOAD_REQUEST_LOG ADD CONSTRAINT PK_DOWNLOAD_REQUEST_LOG 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..ERROR_LOG ADD CONSTRAINT PK_ERROR_LOG 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..METADATA_REQUEST_LOG ADD CONSTRAINT PK_METADATA_REQUEST_LOG 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..NOTIFICATION_TYPE ADD CONSTRAINT PK_NOTIFICATION_TYPES 
	PRIMARY KEY (short_name) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..REMOTE_APPLICATION ADD CONSTRAINT PK_REMOTE_APPLICATIONS 
	PRIMARY KEY (short_name) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..REQUEST_LOG ADD CONSTRAINT PK_REQUEST_LOG 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..SIGNATURE ADD CONSTRAINT PK_SIGNATURE 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..USER_NOTIFICATION ADD CONSTRAINT PK_NOTIFICATIONS 
	PRIMARY KEY (user_code, notification_type) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

ALTER TABLE &&ADIT_SCHEMA..USERTYPE ADD CONSTRAINT PK_USERTYPES 
	PRIMARY KEY (short_name) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;
 
 ALTER TABLE &&ADIT_SCHEMA..NOTIFICATION ADD CONSTRAINT PK_NOTIFICATION 
	PRIMARY KEY (ID) 
 USING INDEX TABLESPACE &&ADIT_INDEX_TABLESPACE.;

/* Create Foreign Key Constraints */
ALTER TABLE &&ADIT_SCHEMA..ACCESS_RESTRICTION ADD CONSTRAINT remote_application_short_name 
	FOREIGN KEY (remote_application) REFERENCES &&ADIT_SCHEMA..REMOTE_APPLICATION (short_name);

ALTER TABLE &&ADIT_SCHEMA..ACCESS_RESTRICTION ADD CONSTRAINT user_code 
	FOREIGN KEY (user_code) REFERENCES &&ADIT_SCHEMA..ADIT_USER (user_code);

ALTER TABLE &&ADIT_SCHEMA..ADIT_USER ADD CONSTRAINT usertype_short_name 
	FOREIGN KEY (usertype) REFERENCES &&ADIT_SCHEMA..USERTYPE (short_name);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT ADD CONSTRAINT document_dvk_status_id 
	FOREIGN KEY (document_dvk_status_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT ADD CONSTRAINT document_type_short_name 
	FOREIGN KEY (type) REFERENCES &&ADIT_SCHEMA..DOCUMENT_TYPE (short_name);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT ADD CONSTRAINT document_workflow_status_id 
	FOREIGN KEY (document_wf_status_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT_WF_STATUS (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT ADD CONSTRAINT parent_document_id 
	FOREIGN KEY (parent_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT ADD CONSTRAINT doc_remote_app_short_name 
	FOREIGN KEY (remote_application) REFERENCES &&ADIT_SCHEMA..REMOTE_APPLICATION (short_name);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_FILE ADD CONSTRAINT document_id 
	FOREIGN KEY (document_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY ADD CONSTRAINT FK_DOCUMENT_HIST_DOCUMENT_HIST 
	FOREIGN KEY (document_history_type) REFERENCES &&ADIT_SCHEMA..DOCUMENT_HISTORY_TYPE (short_name);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY ADD CONSTRAINT FK_DOCUMENT_HIST_REMOTE_APPLIC 
	FOREIGN KEY (remote_application) REFERENCES &&ADIT_SCHEMA..REMOTE_APPLICATION (short_name);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY ADD CONSTRAINT FK_DOCUMENT_HISTORY_DOCUMENT 
	FOREIGN KEY (document_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_HISTORY ADD CONSTRAINT history_user_code 
	FOREIGN KEY (user_code) REFERENCES &&ADIT_SCHEMA..ADIT_USER (user_code);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING ADD CONSTRAINT sharing_document_id 
	FOREIGN KEY (document_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING ADD CONSTRAINT dvk_status_id 
	FOREIGN KEY (dvk_status_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT_DVK_STATUS (ID);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING ADD CONSTRAINT sharing_type_short_name 
	FOREIGN KEY (sharing_type) REFERENCES &&ADIT_SCHEMA..DOCUMENT_SHARING_TYPE (short_name);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING ADD CONSTRAINT sharing_user_code 
	FOREIGN KEY (user_code) REFERENCES &&ADIT_SCHEMA..ADIT_USER (user_code);

ALTER TABLE &&ADIT_SCHEMA..DOCUMENT_SHARING ADD CONSTRAINT wf_status_id 
	FOREIGN KEY (wf_status_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT_WF_STATUS (ID);

ALTER TABLE &&ADIT_SCHEMA..SIGNATURE ADD CONSTRAINT FK_SIGNATURE_DOCUMENT 
	FOREIGN KEY (document_id) REFERENCES &&ADIT_SCHEMA..DOCUMENT (ID);

ALTER TABLE &&ADIT_SCHEMA..SIGNATURE ADD CONSTRAINT FK_SIGNATURE_USER 
	FOREIGN KEY (user_code) REFERENCES &&ADIT_SCHEMA..ADIT_USER (user_code);

ALTER TABLE &&ADIT_SCHEMA..USER_NOTIFICATION ADD CONSTRAINT notification_type_short_name 
	FOREIGN KEY (notification_type) REFERENCES &&ADIT_SCHEMA..NOTIFICATION_TYPE (short_name);

ALTER TABLE &&ADIT_SCHEMA..USER_NOTIFICATION ADD CONSTRAINT notification_user_code 
	FOREIGN KEY (user_code) REFERENCES &&ADIT_SCHEMA..ADIT_USER (user_code);
	
/* Create Triggers */
CREATE SEQUENCE &&ADIT_SCHEMA..ADIT_LOG_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE OR REPLACE TRIGGER &&ADIT_SCHEMA..SET_ADIT_LOG_ID
BEFORE INSERT
ON &&ADIT_SCHEMA..ADIT_LOG
FOR EACH ROW
BEGIN
  SELECT &&ADIT_SCHEMA..ADIT_LOG_ID_SEQ.NEXTVAL
  INTO :NEW.ID
  FROM DUAL;
END;
/

CREATE SEQUENCE &&ADIT_SCHEMA..DOCUMENT_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..DOCUMENT_FILE_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..DOCUMENT_HISTORY_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..DOCUMENT_SHARING_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..DOWNLOAD_REQUEST_LOG_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..ERROR_LOG_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..METADATA_REQUEST_LOG_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..REQUEST_LOG_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..SIGNATURE_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE SEQUENCE &&ADIT_SCHEMA..NOTIFICATION_ID_SEQ
INCREMENT BY 1
START WITH 1
NOMAXVALUE
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

/* Create indexes */
/* All primary key indexes were created with primary key constraints */
CREATE INDEX &&ADIT_SCHEMA..access_restriction_app_idx ON &&ADIT_SCHEMA..access_restriction (remote_application) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..access_restriction_user_idx ON &&ADIT_SCHEMA..access_restriction (user_code) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..adit_user_active_idx ON &&ADIT_SCHEMA..adit_user (active) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..adit_user_usertype_idx ON &&ADIT_SCHEMA..adit_user (usertype) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_dvkstatus_idx ON &&ADIT_SCHEMA..document (document_dvk_status_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_documenttype_idx ON &&ADIT_SCHEMA..document (type) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_wfstatus_idx ON &&ADIT_SCHEMA..document (document_wf_status_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_parent_idx ON &&ADIT_SCHEMA..document (parent_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_app_idx ON &&ADIT_SCHEMA..document (remote_application) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_file_docid_idx ON &&ADIT_SCHEMA..document_file (document_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_history_type_idx ON &&ADIT_SCHEMA..document_history (document_history_type) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_history_app_idx ON &&ADIT_SCHEMA..document_history (remote_application) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_history_docid_idx ON &&ADIT_SCHEMA..document_history (document_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_history_user_idx ON &&ADIT_SCHEMA..document_history (user_code) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_sharing_docid_idx ON &&ADIT_SCHEMA..document_sharing (document_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_sharing_dvkstatus_idx ON &&ADIT_SCHEMA..document_sharing (dvk_status_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_sharing_type_idx ON &&ADIT_SCHEMA..document_sharing (sharing_type) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_sharing_user_idx ON &&ADIT_SCHEMA..document_sharing (user_code) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..document_sharing_wfstatus_idx ON &&ADIT_SCHEMA..document_sharing (wf_status_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..signature_docid_idx ON &&ADIT_SCHEMA..signature (document_id) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..signature_user_idx ON &&ADIT_SCHEMA..signature (user_code) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..user_notification_type_idx ON &&ADIT_SCHEMA..user_notification (notification_type) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
CREATE INDEX &&ADIT_SCHEMA..user_notification_user_idx ON &&ADIT_SCHEMA..user_notification (user_code) TABLESPACE &&ADIT_INDEX_TABLESPACE.;
/* End of indexes */

-- ADIT user must have execute rights for dbms_crypto package
grant execute on dbms_crypto to &&ADIT_SCHEMA;

-- Stored procedure for doing file deflation directly in database
create or replace
procedure &&ADIT_SCHEMA..DEFLATE_FILE(
    result_rc out sys_refcursor,
    document_id in number,
    file_id in number,
    mark_deleted in number
)
as
item_count number(10,0) := 0;
begin
    select  count(*)
    into    item_count
    from    document_file
    where   document_file.id = file_id;
    
    if (item_count > 0) then
            select  count(*)
            into    item_count
            from    document_file
            where   document_file.id = DEFLATE_FILE.file_id
                    and document_file.document_id = DEFLATE_FILE.document_id;
            
            if (item_count > 0) then
                select  count(*)
                into    item_count
                from    document_file
                where   document_file.id = DEFLATE_FILE.file_id
                        and nvl(document_file.deleted, 0) = 0;
                
                if (item_count > 0) then
                    -- Calculate MD5 hash
                    update	document_file
                    set		  file_data = dbms_crypto.hash(nvl(file_data, empty_blob()), 2),
                            deleted = (case when DEFLATE_FILE.mark_deleted = 1 then 1 else document_file.deleted end)
                    where   id = DEFLATE_FILE.file_id;
                    
                    open result_rc for
                    select  'ok' as result_code
                    from    dual;
                else
                    open result_rc for
                    select  'already_deleted' as result_code
                    from    dual;
                end if;
            else
                open result_rc for
                select  'file_does_not_belong_to_document' as result_code
                from    dual;
            end if;
    else
        open result_rc for
        select  'file_does_not_exist' as result_code
        from    dual;
    end if;
end;
/
